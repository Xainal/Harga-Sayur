<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Update Harga Sayur Grosir Harian / MAKASSAR (Pasar Kalimbu)</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:#f6f7fb;
  color:#111827;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:24px 16px;
}
h1{margin:0 0 6px}
.subtitle{color:#6b7280;margin-bottom:16px}
.panel{
  background:#ffd54a;
  border-radius:16px;
  padding:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);
}
.top{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:space-between;
  align-items:flex-end;
}
.chip{
  background:rgba(255,255,255,.7);
  border:1px solid rgba(0,0,0,.15);
  border-radius:999px;
  padding:6px 10px;
  font-size:13px;
}
.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
label{font-size:13px}
select,input{
  padding:8px 10px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,.2);
}
button{
  border:none;
  border-radius:10px;
  padding:9px 12px;
  font-weight:600;
  cursor:pointer;
}
.btn-dark{background:#111827;color:#fff}
.btn-light{background:#fff;border:1px solid rgba(0,0,0,.2)}
.table-wrap{
  margin-top:14px;
  overflow-x:auto;
  background:#fff;
  border-radius:14px;
}
table{
  width:100%;
  border-collapse:collapse;
  min-width:760px;
}
th,td{
  padding:12px;
  border-bottom:1px solid #e5e7eb;
  text-align:left;
}
th{background:#f3f4f6}
.num{text-align:right}
.badge{
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
}
.up{background:#d1fae5;color:#065f46}
.down{background:#fee2e2;color:#7f1d1d}
.flat{background:#e5e7eb;color:#374151}

/* modal */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  justify-content:center;
  align-items:center;
}
.modal{
  background:#fff;
  border-radius:16px;
  max-width:900px;
  width:100%;
  max-height:90vh;
  overflow:auto;
}
.modal header{
  padding:16px;
  border-bottom:1px solid #e5e7eb;
}
.modal main{padding:16px}
.modal footer{
  padding:12px 16px;
  border-top:1px solid #e5e7eb;
  display:flex;
  justify-content:flex-end;
  gap:10px;
}
.grid{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
@media(min-width:768px){
  .grid{grid-template-columns:1fr 1fr}
}
</style>
</head>

<body>
<div class="container">
  <h1>Update Harga Sayur Grosir Harian</h1>
  <div class="subtitle">Satuan: <b>Per Kantong</b></div>

  <div class="panel">
    <div class="top">
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <span class="chip" id="chipSource">Sumber: -</span>
        <span class="chip" id="chipUpdated">Last update: -</span>
      </div>

      <div class="controls">
        <div>
          <label>Tanggal</label><br>
          <select id="dateSelect"></select>
        </div>
        <div>
          <label>Cari</label><br>
          <input id="search" placeholder="tomat, buncis...">
        </div>
        <button class="btn-light" onclick="exportCSV()">Export CSV</button>
        <button class="btn-dark" onclick="openAdmin()">Update Harga</button>
      </div>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>No</th>
            <th>Komoditas</th>
            <th class="num">Harga (Rp/kantong)</th>
            <th class="num">Perubahan</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <p style="font-size:13px;color:#374151;margin-top:10px">
      * Harga di bawah adalah <b>harga grosir per kantong</b>
    </p>
  </div>
</div>

<!-- MODAL -->
<div class="overlay" id="overlay">
  <div class="modal">
    <header>
      <b>Update Harga Grosir</b>
      <div style="font-size:13px;color:#6b7280" id="modalDate"></div>
    </header>
    <main>
      <label>Sumber Harga</label><br>
      <select id="source" style="margin-bottom:14px">
        <option>Pasar Induk</option>
        <option>Supplier</option>
        <option>Gudang</option>
      </select>

      <div class="grid" id="formGrid"></div>
    </main>
    <footer>
      <button class="btn-light" onclick="closeAdmin()">Batal</button>
      <button class="btn-dark" onclick="saveData()">Simpan</button>
    </footer>
  </div>
</div>

<script>
const PIN="1234";
const ITEMS=[
 "Tomat","Cabe Keriting","Daun Bawang","Sawi Putih",
 "Cabe Keriting Hijau","Wortel Super","Wortel Cakar","Buncis"
];
const SEED={
 "Tomat":25000,"Cabe Keriting":45000,"Daun Bawang":18000,"Sawi Putih":15000,
 "Cabe Keriting Hijau":38000,"Wortel Super":22000,"Wortel Cakar":20000,"Buncis":24000
};

const rupiah=n=>"Rp "+Number(n||0).toLocaleString("id-ID");
const today=()=>new Date().toISOString().slice(0,10);
const yest=d=>{let x=new Date(d);x.setDate(x.getDate()-1);return x.toISOString().slice(0,10)};
const key=d=>"harga_kantong_"+d;

let curDate=today(), curData={}, prevData={};

function init(){
 let t=today(), y=yest(t);
 dateSelect.innerHTML=`<option>${t}</option><option>${y}</option>`;
 seed(t); seed(y);
 load(t);
 dateSelect.onchange=e=>load(e.target.value);
 search.oninput=render;
}
function seed(d){
 if(!localStorage[key(d)])
  localStorage[key(d)]=JSON.stringify({date:d,source:"Pasar Induk",time:new Date(),prices:{...SEED}});
}
function load(d){
 curDate=d;
 curData=JSON.parse(localStorage[key(d)]);
 prevData=JSON.parse(localStorage[key(yest(d))]);
 modalDate.textContent="Tanggal: "+d;
 source.value=curData.source;
 buildForm();
 render();
}
function buildForm(){
 formGrid.innerHTML="";
 ITEMS.forEach(i=>{
  let id=i.replace(/\s/g,"_");
  formGrid.innerHTML+=`
   <div>
    <label>${i}</label>
    <input id="${id}" type="number" value="${curData.prices[i]||0}">
   </div>`;
 });
}
function render(){
 let q=search.value.toLowerCase();
 tbody.innerHTML="";
 ITEMS.filter(i=>i.toLowerCase().includes(q)).forEach((i,n)=>{
  let cur=curData.prices[i]||0;
  let prev=prevData.prices[i]||0;
  let diff=cur-prev;
  let st=diff>0?"up":diff<0?"down":"flat";
  let txt=diff>0?"Naik":diff<0?"Turun":"Tetap";
  tbody.innerHTML+=`
   <tr>
    <td>${n+1}</td>
    <td><b>${i}</b></td>
    <td class="num">${rupiah(cur)}</td>
    <td class="num">${rupiah(diff)}</td>
    <td><span class="badge ${st}">${txt}</span></td>
   </tr>`;
 });
 chipSource.textContent="Sumber: "+curData.source;
 chipUpdated.textContent="Last update: "+new Date(curData.time).toLocaleString("id-ID");
}
function openAdmin(){
 let p=prompt("PIN Admin:");
 if(p!==PIN) return alert("PIN salah");
 overlay.style.display="flex";
}
function closeAdmin(){overlay.style.display="none";}
function saveData(){
 ITEMS.forEach(i=>{
  let id=i.replace(/\s/g,"_");
  curData.prices[i]=Number(document.getElementById(id).value||0);
 });
 curData.source=source.value;
 curData.time=new Date();
 localStorage[key(curDate)]=JSON.stringify(curData);
 closeAdmin(); render();
}
function exportCSV(){
 let csv="Komoditas,Harga\\n";
 ITEMS.forEach(i=>csv+=`${i},${curData.prices[i]}\\n`);
 let a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
 a.download="harga_grosir_kantong.csv";
 a.click();
}

init();
</script>
</body>
</html>
